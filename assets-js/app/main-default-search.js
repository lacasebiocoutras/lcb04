define(["jquery","lunr","moment","config-module"],function(e,i,n,a){function t(e){return String(e).replace(/&amp;/g,"&")}function c(e,i,a){var t;t=e.length>0?n(e,a):n();var c;c=i.length>0?n(i,a):n();var r=n(t).subtract(1,"days"),o=n(c).add(1,"days");return!!n().isBetween(r.format(),o.format())}function r(e){e.length?(f.empty(),v(e)):(f.html(h),w())}var o=function(n){if(!arguments.length||null===n||void 0===n)return[];if(Array.isArray(n))return n.map(function(e){return i.utils.asString(e).toLowerCase()});var a=n.toString().trim().toLowerCase().split(i.tokenizer.seperator);return e.each(a,function(e,i){var n=i.replace(/à/gi,"a").replace(/â/gi,"a").replace(/ç/gi,"c").replace(/é/gi,"e").replace(/è/gi,"e").replace(/ê/gi,"e").replace(/î/gi,"i").replace(/ô/gi,"o").replace(/ù/gi,"u").replace(/û/gi,"u");a[e]=n}),a};i.tokenizer.registerFunction(o,"myCustomTokenizer"),window.idx=i(function(){this.pipeline.reset(),this.tokenizer(o),this.field("id"),this.field("title",{boost:10}),this.field("author"),this.field("category"),this.field("tags")}),n.locale("fr");var s=" ",l="",d=l,f=e("#search_results"),u=["DDMMMMY"],h="<li>Pas de résultat trouvé</li>",w=function(){window.data.then(function(i){e.each(i,function(i,n){var a="#";a=a.concat(n.name_id),e(a).addClass(window.config.class_invisible_search)})})},_=function(){window.data.then(function(i){e.each(i,function(i,n){var a="#";a=a.concat(n.name_id),c(n.date_debut,n.date_fin,u)?e(a).removeClass(window.config.class_invisible_search):e(a).addClass(window.config.class_invisible_search)})})},g=function(i){n.locale("fr");var a="#";a=a.concat(i.name_id),c(i.date_debut,i.date_fin,u)?e(a).removeClass(window.config.class_invisible_search):e(a).addClass(window.config.class_invisible_search)},v=function(i){var n,a="#",t=!1;window.data.then(function(r){e.each(r,function(o,s){var l=s.name_id,d=!0;i.forEach(function(e){var i=e.ref,n=r[i];n.name_id===l&&(d=!1)}),n=a.concat(l),c(s.date_debut,s.date_fin,u)||(d=!0),d===!0?e(n).addClass(window.config.class_invisible_search):(e(n).removeClass(window.config.class_invisible_search),t=!0)})}),t===!1&&f.html(h)},m=window.location.href,p=a.base_url.concat(a.json_search_config),b=e.getJSON(p),y=b.then(function(i){window.config=i.config;var n=null;return e.each(i.list,function(e,i){m.indexOf(i.url)>-1&&(n=i.name)}),n}),S=y.then(function(e){return a.base_url.concat(e)});S.then(function(i){window.data=e.getJSON(i),window.data.then(function(i){e.each(i,function(i,n){window.idx.add(e.extend({id:i},n)),g(n)})})});e(".catSearchShowAll").bind("click",function(){e("#search_box").val(""),d=l,e(this).parents().find(".termSearch").css("color","black"),_()}),e(".catSearch").bind("click",function(){var i=e(this).parent().find(".termSearch"),n=i.html();n=t(n),d=window.config.add_delim_categorie_search,d=d.concat(n),d=d.concat(window.config.add_delim_categorie_search),e(this).parents().find(".termSearch").css("color","black"),i.css("color","red"),e("#search_box").val("");var a=window.idx.search(d);r(a)});var x=function(e){var i;return function(){var n=Array.prototype.slice.call(arguments),a=this;clearTimeout(i),i=setTimeout(function(){e.apply(a,n)},100)}};e("#search_box").bind("keyup",x(function(){var i,n=e(this).val();n===l?d===l?_():(i=window.idx.search(d),r(i)):(d!==l&&(n=n.concat(s,d)),i=window.idx.search(n),r(i))}))});